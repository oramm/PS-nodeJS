# Task Plan Context Template (Documentation Layers v2)

task_id: ""
task_name: ""
task_type: "feature|refactor|mixed|architecture|ops"
execution_model: "orchestrator_v1"
main_agent_policy:
  can_edit_code: false
discovery_mode: false         # true for seed-stage / high-uncertainty tasks
discovery_gate: "none"        # none | pending | DISCOVERY_APPROVED | DISCOVERY_REJECTED
operations_feature_slug: ""   # e.g. persons-v2-refactor
operations_docs_path: ""      # e.g. documentation/team/operations/persons-v2-refactor/
docs_sync_targets:            # canonical docs updated at closure
  - ""                        # e.g. documentation/team/architecture/system-map.md
closure_policy: "replace_docs_and_purge_plan"  # replace_docs_and_purge_plan | keep_plan_open
closure_gate:
  require_test_pass: true
  require_review_approve: true
  require_docs_sync_done: true

acceptance_criteria:
  - ""

discovery_context:
  open_questions: []
  future_assumptions: []
  ui_flow_notes: []
  as_is_map: []
  solution_options: []
  flow_diagram: ""            # text/mermaid
  impact_matrix:              # summarize expected impact by layer
    ui: ""
    api: ""
    db: ""
    docs: ""
    tests: ""
    risks: ""

# Required context only (max 5-8 files)
required_context_files:
  - "factory/CONCEPT.md"
  - "factory/TOOL-ADAPTERS.md"
  - "factory/prompts/reviewer.md"

# Optional context loaded only if needed
optional_context_files:
  - ""

# Soft limit: 12000-20000
context_budget_tokens: 12000

documentation_layers:
  backend:
    canonical: true
    adapters: false
    factory: false
  client:
    canonical: false
    adapters: false

documentation_selection_justification:
  - ""

delivery_balance:
  feature_task_in_iteration: true
  refactor_task_in_iteration: true
  notes: ""

# --- Layer 3: Planner fields ---
technical_objectives:
  - objective: ""        # End-state of the system (what must work)
    constraints: ""      # What must not be changed

verification_criteria:
  hard: []               # Blocking for APPROVE (e.g. tests)
  soft: []               # Warnings for Reviewer

escalation_triggers: []  # Measurable thresholds -> STOP -> human

context_budget:
  max_files_for_coder: 8
  estimated_tokens: 15000
  subagent_scope: ""     # Narrow scope for coder subagents

parallelization:
  max_parallel_coders: 3
  sharding_mode: "parallel|sequential"
  sharding_decision_reason: ""
  shards:
    - id: ""
      objective: ""
      owned_paths: []
      excluded_paths: []
      dependencies: []

integration_gate:
  require_all_shards_test_pass: true
  require_all_shards_review_approve: true
  conflict_policy: "escalate_or_replan"
  status: "INTEGRATION_READY|INTEGRATION_BLOCKED"

context_rollover:
  pre_session_budget_check: true
  remaining_capacity_threshold_pct: 40
  enforce_plan_scope_limits: true
  handoff_artifacts_required:
    - "status_snapshot"
    - "progress_update"
    - "activity_log_entry"
    - "next_session_prompt"

session_resume_contract:
  mandatory_read_order:
    - "plan"
    - "progress"
    - "activity-log"
    - "project-instructions"
  execute_only_first_open_checkpoint: true
  blocked_checkpoint_fallback: "escalate_and_wait"

plan_deviation: null     # Filled by Coder when an unexpected blocker appears
